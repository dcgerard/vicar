<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>BACKWASH: Bayesian Adjustment for Confounding Knitted With Adaptive
SHrinkage. — backwash • vicar</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="BACKWASH: Bayesian Adjustment for Confounding Knitted With Adaptive
SHrinkage. — backwash" />
<meta property="og:description" content="This function implements the full BACKWASH method. This method is
very similar to the mouthwash method with one very
key difference: rather than estimate the confounders by maximum
likelihood, backwash goes more Bayesian and places a g-like prior
on the confounders. We fit the model by variational approximations." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vicar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1-11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/customFA.html">Customizable Factor Analyses</a>
    </li>
    <li>
      <a href="../articles/custom_prior.html">Custom Prior for RUVB</a>
    </li>
    <li>
      <a href="../articles/sample_analysis.html">Sample Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/dcgerard/vicar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>BACKWASH: Bayesian Adjustment for Confounding Knitted With Adaptive
SHrinkage.</h1>
    <small class="dont-index">Source: <a href='http://github.com/dcgerard/vicar/blob/master/R/backwash.R'><code>R/backwash.R</code></a></small>
    <div class="hidden name"><code>backwash.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function implements the full BACKWASH method. This method is
very similar to the <code><a href='mouthwash.html'>mouthwash</a></code> method with one very
key difference: rather than estimate the confounders by maximum
likelihood, backwash goes more Bayesian and places a g-like prior
on the confounders. We fit the model by variational approximations.</p>
    </div>

    <pre class="usage"><span class='fu'>backwash</span><span class='op'>(</span>
  <span class='va'>Y</span>,
  <span class='va'>X</span>,
  k <span class='op'>=</span> <span class='cn'>NULL</span>,
  cov_of_interest <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,
  include_intercept <span class='op'>=</span> <span class='cn'>TRUE</span>,
  limmashrink <span class='op'>=</span> <span class='cn'>TRUE</span>,
  fa_func <span class='op'>=</span> <span class='va'>pca_naive</span>,
  fa_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  lambda_type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"zero_conc"</span>, <span class='st'>"uniform"</span><span class='op'>)</span>,
  pi_init_type <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"zero_conc"</span>, <span class='st'>"uniform"</span>, <span class='st'>"random"</span><span class='op'>)</span>,
  grid_seq <span class='op'>=</span> <span class='cn'>NULL</span>,
  lambda_seq <span class='op'>=</span> <span class='cn'>NULL</span>,
  lambda0 <span class='op'>=</span> <span class='fl'>10</span>,
  scale_var <span class='op'>=</span> <span class='cn'>TRUE</span>,
  sprop <span class='op'>=</span> <span class='fl'>0</span>,
  var_inflate_pen <span class='op'>=</span> <span class='fl'>0</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>A matrix of numerics. These are the response variables
where each column has its own variance. In a gene expression
study, the rows are the individuals and the columns are the
genes.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>A matrix of numerics. The observed covariates.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>A non-negative integer.The number of unobserved
confounders. If not specified and the R package sva is
installed, then this function will estimate the number of
hidden confounders using the methods of Buja and Eyuboglu
(1992).</p></td>
    </tr>
    <tr>
      <th>cov_of_interest</th>
      <td><p>A positive integer. The column number of the
covariate in X whose coefficients you are interested in.
The rest are considered nuisance parameters and are regressed
out by OLS.</p></td>
    </tr>
    <tr>
      <th>include_intercept</th>
      <td><p>A logical. If <code>TRUE</code>, then it will
check <code>X</code> to see if it has an intercept term. If not, then
it will add an intercept term. If <code>FALSE</code>, then <code>X</code>
will be unchanged.</p></td>
    </tr>
    <tr>
      <th>limmashrink</th>
      <td><p>A logical. Should we apply hierarchical
shrinkage to the variances (<code>TRUE</code>) or not (<code>FALSE</code>)?
If <code>degrees_freedom = NULL</code> and <code>limmashrink = TRUE</code>
and <code>likelihood = "t"</code>, then we'll also use the limma
returned degrees of freedom.</p></td>
    </tr>
    <tr>
      <th>fa_func</th>
      <td><p>A factor analysis function. The function must have
as inputs a numeric matrix <code>Y</code> and a rank (numeric scalar)
<code>r</code>. It must output numeric matrices <code>alpha</code> and
<code>Z</code> and a numeric vector <code>sig_diag</code>. <code>alpha</code> is
the estimate of the coefficients of the unobserved confounders,
so it must be an <code>r</code> by <code><a href='https://rdrr.io/r/base/nrow.html'>ncol(Y)</a></code> matrix. <code>Z</code>
must be an <code>r</code> by <code><a href='https://rdrr.io/r/base/nrow.html'>nrow(Y)</a></code> matrix. <code>sig_diag</code>
is the estimate of the column-wise variances so it must be of
length <code><a href='https://rdrr.io/r/base/nrow.html'>ncol(Y)</a></code>. The default is the function
<code>pca_naive</code> that just uses the first <code>r</code> singular
vectors as the estimate of <code>alpha</code>. The estimated
variances are just the column-wise mean square.</p></td>
    </tr>
    <tr>
      <th>fa_args</th>
      <td><p>A list. Additional arguments you want to pass to
fa_func.</p></td>
    </tr>
    <tr>
      <th>lambda_type</th>
      <td><p>A character. Should we apply a penalty on zero
(<code>"zero_conc"</code>) or no penalty (<code>"uniform"</code>). Not used
if <code>lambda_seq</code> is not <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>pi_init_type</th>
      <td><p>How should we initialize the mixing
proportions? By concentrating on zero (<code>"zero_conc"</code>), by
equal weights on all mixing distributions (<code>"uniform"</code>),
or by sampling uniformly on the simplex (<code>"random"</code>)?</p></td>
    </tr>
    <tr>
      <th>grid_seq</th>
      <td><p>The grid for the mixing distribution. If
<code>mixing_dist = "uniform"</code> or <code>"+uniform"</code>, then these
should be the non-zero limits of the uniform distributions. If
<code>mixing_dist = "sym_uniform"</code>, then these should be the
right limits of the uniform distributions. If <code>mixing_dist
= "normal"</code>, then these should be the variances of the mixing
normal distributions.</p></td>
    </tr>
    <tr>
      <th>lambda_seq</th>
      <td><p>A numeric vector with elements all greater than
or equal to 1. These are the tuning parameters for the mixing
proportions. This can only be specified if <code>grid_seq</code> is
also specified.</p></td>
    </tr>
    <tr>
      <th>lambda0</th>
      <td><p>A numeric greater than or equal to 1. The penalty on
zero if <code>lambda_type = "zero_conc"</code>.</p></td>
    </tr>
    <tr>
      <th>scale_var</th>
      <td><p>A logical. Should we estimate a variance inflation
parameter (<code>TRUE</code>) or not (<code>FALSE</code>)?</p></td>
    </tr>
    <tr>
      <th>sprop</th>
      <td><p>If \(b\) is an effect and \(s\) is an estimated
standard error, then we model \(b/s^{sprop}\) as
exchangeable. The default is 0. When <code>sprop = 1</code>, for
identifiability reasons it must be the case that
<code>scale_var = FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>var_inflate_pen</th>
      <td><p>The penalty to apply on the variance inflation parameter.
Defaults to 0, but should be something non-zero when <code>alpha = 1</code>
and <code>scale_var = TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>If <code>verbose = TRUE</code>, print progress of the algorithm
to the console.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>backwash</code> returns a list with some or all of the
    following elements:</p>
<p><code>result</code>: A data frame with the following columns:</p><ul>
<li><p><code>betahat</code>: The ordinary least squares (OLS) coefficients for the variable of interest.</p></li>
<li><p><code>sebetahat</code>: The standard errors of the OLS regression coefficients (with or without limma-shrinkage depending on the argument of <code>limmashrink</code>).</p></li>
<li><p><code>NegativeProb</code>: The posterior probability of an effect being less than zero.</p></li>
<li><p><code>PositiveProb</code>: The posterior probability of an effect being greater than zero.</p></li>
<li><p><code>lfsr</code>: The local false sign rate for the effects. See Stephens (2016).</p></li>
<li><p><code>svalue</code>: The estimated average error rate in sign detection.</p></li>
<li><p><code>lfdr</code>: The local false discovery rates.</p></li>
<li><p><code>qvalue</code>: The estimated average error rate in signal detection.</p></li>
<li><p><code>PosteriorMean</code>: The posterior means of the effects.</p></li>
<li><p><code>PosteriorSD</code>: The posterior standard deviations of the effects.</p></li>
</ul>

<p><code>elbo</code>: The value of the evidence lower bound at the final
    parameter values.</p>
<p><code>xi</code>: The estimated variance scaling parameter.</p>
<p><code>phi</code>: The estimated "g" parameter in the g-prior on the confounders.</p>
<p><code>z2hat</code>: A function of the confounders. Mostly used for
    debugging.</p>
<p><code>pi0</code>: The estimated proportion of null effects.</p>
<p><code>Zhat</code>: The estimate of the confounders.</p>
<p><code>alphahat</code>: The estimate of the coefficients of the
    confounders.</p>
<p><code>sig_diag</code>: The estimate of the variances.</p>
<p><code>fitted_g</code>: A list with the following elements:</p><ul>
<li><p><code>pivec</code>: The estimated prior mixing proportions.</p></li>
<li><p><code>tau2_seq</code>: The prior mixing variances.</p></li>
<li><p><code>means</code>: A matrix of the variational mixing means. The columns index the observations and the rows index the mixing distributions.</p></li>
<li><p><code>variances</code>: A matrix of the variational mixing variances. The columns index the observations and the rows index the mixing distributions.</p></li>
<li><p><code>proportions</code>: A matrix of the variational mixing proportions. The columns index the observations and the rows index the mixing distributions.</p></li>
</ul>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The assumed model is $$Y = X\beta + Z\alpha + E.$$ \(Y\) is a
\(n\) by <code>p</code> matrix of response variables. For example, each
row might be an array of log-transformed gene-expression data.
\(X\) is a \(n\) by \(q\) matrix of observed covariates. It
is assumed that all but one column of which contains nuisance
parameters. For example, the first column might be a vector of ones
to include an intercept. \(\beta\) is a \(q\) by \(p\) matrix
of corresponding coefficients.  \(Z\) is a \(n\) by \(k\)
matrix of confounder variables. \(\alpha\) is the corresponding
\(k\) by \(p\) matrix of coefficients for the unobserved
confounders. \(E\) is a \(n\) by \(p\) matrix of error
terms. \(E\) is assumed to be matrix normal with identity row
covariance and diagonal column covariance \(\Sigma\). That is,
the columns are heteroscedastic while the rows are homoscedastic
independent.</p>
<p>This function will first rotate \(Y\) and \(X\) using the QR
decomposition. This separates the model into three parts. The first
part contains nuisance parameters, the second part contains the
coefficients of interest, and the third part contains the
confounders. <code>backwash</code> applies a user-provided factor
analysis to the third part to estimate the confounding factors,
then places a g-like prior on the confounders corresponding to the
second equation.  It then jointly estimates the coefficients of
interest and the posterior of the confounders using a VEM
(Variational Expectation Maximization) algorithm, placing a
g-prior on the hidden confounders.</p>
<p>There are a couple forms of factor analysis available in this
package. The default is PCA with the column-wise residual
mean-squares as the estimates of the column-wise variances.</p>
<p>For instructions and examples on how to specify your own factor analysis, run the following code in R:
<code><a href='../articles/customFA.html'>utils::vignette("customFA", package = "vicar")</a></code>. If it doesn't work, then you probably haven't built
the vignettes. To do so, see <a href='https://github.com/dcgerard/vicar#vignettes'>https://github.com/dcgerard/vicar#vignettes</a>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ul>
<li><p>Gerard, D., and Stephens, M. 2020. "Empirical Bayes shrinkage and false discovery rate estimation, allowing for unwanted variation", <em>Biostatistics</em>, 21(1), 15-32 doi: <a href='https://doi.org/10.1093/biostatistics/kxy029'>10.1093/biostatistics/kxy029</a></p></li>
<li><p>Stephens, Matthew. 2016. "False discovery rates: a new deal." <em>Biostatistics</em> 18 (2): 275–94. doi: <a href='https://doi.org/10.1093/biostatistics/kxw041'>10.1093/biostatistics/kxw041</a></p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='mouthwash.html'>mouthwash</a></code> For a similar method that maximizes over the hidden confounders
    rather than puts a prior on them.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>David Gerard</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/dcgerard/vicar'>vicar</a></span><span class='op'>)</span>

<span class='co'>## Generate data ----------------------------------------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>116</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>13</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>101</span>
<span class='va'>k</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='va'>q</span> <span class='op'>&lt;-</span> <span class='fl'>3</span>
<span class='va'>is_null</span>       <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>FALSE</span>, length <span class='op'>=</span> <span class='va'>p</span><span class='op'>)</span>
<span class='va'>is_null</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>57</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>

<span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>q</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>B</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>q</span> <span class='op'>*</span> <span class='va'>p</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>q</span><span class='op'>)</span>
<span class='va'>B</span><span class='op'>[</span><span class='fl'>2</span>, <span class='va'>is_null</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
<span class='va'>Z</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'>%*%</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>q</span> <span class='op'>*</span> <span class='va'>k</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>q</span><span class='op'>)</span> <span class='op'>+</span>
     <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>k</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>k</span> <span class='op'>*</span> <span class='va'>p</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>k</span><span class='op'>)</span>
<span class='va'>E</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>p</span>, sd <span class='op'>=</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'>%*%</span> <span class='va'>B</span> <span class='op'>+</span> <span class='va'>Z</span> <span class='op'>%*%</span> <span class='va'>A</span> <span class='op'>+</span> <span class='va'>E</span>

<span class='co'>## Fit BACKWASH -----------------------------------------------------------</span>
<span class='va'>bout</span> <span class='op'>&lt;-</span> <span class='fu'>backwash</span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>Y</span>, X <span class='op'>=</span> <span class='va'>X</span>, k <span class='op'>=</span> <span class='va'>k</span>, include_intercept <span class='op'>=</span> <span class='cn'>FALSE</span>,
                 cov_of_interest <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  - Computing independent basis using QR decomposition.
#&gt;  - Computation took 0.132 seconds.
#&gt;  - Running additional preprocessing steps.
#&gt;  - Computation took 0.001 seconds.
#&gt;  - Running second step of backwash:
#&gt;     + Initializing parameters for EM algorithm.
#&gt;     + Computation took 0.789 seconds.
#&gt;     + Running one round of parameter updates.
#&gt;     + Computation took 0.003 seconds.
#&gt;     + Estimating model parameters using EM.
#&gt;     + Computation took 0.673 seconds.
#&gt;     + Generating posterior statistics.
#&gt;     + Computation took 0.002 seconds.
#&gt;  - Second step took 1.902 seconds.
#&gt;  - Generating final backwash outputs.
#&gt;  - Computation took 0 seconds.</div><div class='input'><span class='va'>bout</span><span class='op'>$</span><span class='va'>pi0</span> <span class='co'>## Estimate</span>
</div><div class='output co'>#&gt; [1] 0.5962884</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>)</span> <span class='co'>## Truth</span>
</div><div class='output co'>#&gt; [1] 0.5643564</div><div class='input'>
<span class='co'>## Fit MOUTHWASH ----------------------------------------------------------</span>
<span class='va'>mout</span> <span class='op'>&lt;-</span> <span class='fu'><a href='mouthwash.html'>mouthwash</a></span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>Y</span>, X <span class='op'>=</span> <span class='va'>X</span>, k <span class='op'>=</span> <span class='va'>k</span>, include_intercept <span class='op'>=</span> <span class='cn'>FALSE</span>,
                  cov_of_interest <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Running mouthwash on 13 x 3 matrix X and 13 x 101 matrix Y.
#&gt;  - Computing independent basis using QR decomposition.
#&gt;  - Computation took 0.001 seconds.
#&gt;  - Running additional preprocessing steps.
#&gt;  - Computation took 0.001 seconds.
#&gt;  - Running second step of mouthwash:
#&gt;     + Estimating model parameters using EM.
#&gt;     + Computation took 0.549 seconds.
#&gt;     + Generating adaptive shrinkage (ash) output.
#&gt;     + Computation took 0.012 seconds.
#&gt;  - Second step took 0.821 seconds.
#&gt;  - Estimating additional hidden confounders.
#&gt;  - Computation took 0.001 seconds.</div><div class='input'><span class='va'>mout</span><span class='op'>$</span><span class='va'>pi0</span> <span class='co'>## Estimate</span>
</div><div class='output co'>#&gt; [1] 0.593371</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>)</span> <span class='co'>## Truth</span>
</div><div class='output co'>#&gt; [1] 0.5643564</div><div class='input'>
<span class='co'>## Very Similar LFDR's ----------------------------------------------------</span>
<span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>mout</span><span class='op'>$</span><span class='va'>result</span><span class='op'>$</span><span class='va'>lfdr</span>, <span class='va'>bout</span><span class='op'>$</span><span class='va'>result</span><span class='op'>$</span><span class='va'>lfdr</span>, col <span class='op'>=</span> <span class='va'>is_null</span> <span class='op'>+</span> <span class='fl'>3</span>,
               xlab <span class='op'>=</span> <span class='st'>"MOUTHWASH"</span>, ylab <span class='op'>=</span> <span class='st'>"BACKWASH"</span>, main <span class='op'>=</span> <span class='st'>"LFDR's"</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomright"</span>, legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Null"</span>, <span class='st'>"Non-null"</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>3</span><span class='op'>)</span>,
                 pch <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='img'><img src='backwash-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>## Exact Same ROC Curves --------------------------------------------------</span>
<span class='va'>morder_lfdr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>mout</span><span class='op'>$</span><span class='va'>result</span><span class='op'>$</span><span class='va'>lfdr</span><span class='op'>)</span>
<span class='va'>mfpr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>morder_lfdr</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>)</span>
<span class='va'>mtpr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>morder_lfdr</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>)</span>

<span class='va'>border_lfdr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>bout</span><span class='op'>$</span><span class='va'>result</span><span class='op'>$</span><span class='va'>lfdr</span><span class='op'>)</span>
<span class='va'>bfpr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>border_lfdr</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>)</span>
<span class='va'>btpr</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>border_lfdr</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>)</span>

<span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>bfpr</span>, <span class='va'>btpr</span>, type <span class='op'>=</span> <span class='st'>"l"</span>, xlab <span class='op'>=</span> <span class='st'>"False Positive Rate"</span>,
               ylab <span class='op'>=</span> <span class='st'>"True Positive Rate"</span>, main <span class='op'>=</span> <span class='st'>"ROC Curve"</span>, col <span class='op'>=</span> <span class='fl'>3</span>,
               lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>mfpr</span>, <span class='va'>mtpr</span>, col <span class='op'>=</span> <span class='fl'>4</span>, lty <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, lty <span class='op'>=</span> <span class='fl'>2</span>, col <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomright"</span>, legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"MOUTHWASH"</span>, <span class='st'>"BACKWASH"</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>3</span><span class='op'>)</span>,
                 lty <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='img'><img src='backwash-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>## But slightly different ordering ----------------------------------------</span>
<span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>morder_lfdr</span>, <span class='va'>border_lfdr</span>, col <span class='op'>=</span> <span class='va'>is_null</span> <span class='op'>+</span> <span class='fl'>3</span>, xlab <span class='op'>=</span> <span class='st'>"MOUTHWASH"</span>,
               ylab <span class='op'>=</span> <span class='st'>"BACKWASH"</span>, main <span class='op'>=</span> <span class='st'>"Order"</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomright"</span>, legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Null"</span>, <span class='st'>"Non-null"</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>4</span>, <span class='fl'>3</span><span class='op'>)</span>,
                 pch <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='img'><img src='backwash-3.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Gerard, Peter Carbonetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


