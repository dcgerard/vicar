<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Bayesian version of Removing Unwanted Variation. — ruvb • vicar</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Bayesian version of Removing Unwanted Variation. — ruvb" />
<meta property="og:description" content="This function will take posterior draws from a Bayesian factor
analysis (or, more generally, a Bayesian imputation approach) to
propagate uncertainty when adjusting for unwanted variation. Useful
summaries are returned, such as local false sign rates and
posterior means." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vicar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1-11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/customFA.html">Customizable Factor Analyses</a>
    </li>
    <li>
      <a href="../articles/custom_prior.html">Custom Prior for RUVB</a>
    </li>
    <li>
      <a href="../articles/sample_analysis.html">Sample Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/dcgerard/vicar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bayesian version of Removing Unwanted Variation.</h1>
    <small class="dont-index">Source: <a href='http://github.com/dcgerard/vicar/blob/master/R/ruvb.R'><code>R/ruvb.R</code></a></small>
    <div class="hidden name"><code>ruvb.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function will take posterior draws from a Bayesian factor
analysis (or, more generally, a Bayesian imputation approach) to
propagate uncertainty when adjusting for unwanted variation. Useful
summaries are returned, such as local false sign rates and
posterior means.</p>
    </div>

    <pre class="usage"><span class='fu'>ruvb</span><span class='op'>(</span>
  <span class='va'>Y</span>,
  <span class='va'>X</span>,
  <span class='va'>ctl</span>,
  k <span class='op'>=</span> <span class='cn'>NULL</span>,
  fa_func <span class='op'>=</span> <span class='va'>bfa_gs_linked</span>,
  fa_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  cov_of_interest <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,
  include_intercept <span class='op'>=</span> <span class='cn'>TRUE</span>,
  return_mcmc <span class='op'>=</span> <span class='cn'>FALSE</span>,
  prior_fun <span class='op'>=</span> <span class='cn'>NULL</span>,
  prior_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  return_log <span class='op'>=</span> <span class='cn'>NULL</span>,
  pad_na <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>A matrix of numerics. These are the response variables
where each column has its own variance. In a gene expression
study, the rows are the individuals and the columns are the
genes.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>A matrix of numerics. The covariates of interest.</p></td>
    </tr>
    <tr>
      <th>ctl</th>
      <td><p>A vector of logicals of length <code><a href='https://rdrr.io/r/base/nrow.html'>ncol(Y)</a></code>. If
position i is <code>TRUE</code> then position i is considered a
negative control.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>A non-negative integer.The number of unobserved
confounders. If not specified and the R package sva is
installed, then this function will estimate the number of
hidden confounders using the methods of Buja and Eyuboglu
(1992).</p></td>
    </tr>
    <tr>
      <th>fa_func</th>
      <td><p>A function that takes as input matrices named
<code>Y21</code>, <code>Y31</code>, <code>Y32</code>, and <code>k</code> and returns a
list, one of whose elements is called <code>Y22_array</code>. See
<code><a href='bfa_gs_linked.html'>bfa_gs_linked</a></code> for an example function. Type in R
<code><a href='../articles/customFA.html'>utils::vignette("customFA", package = "vicar")</a></code> for
instructions and examples.</p></td>
    </tr>
    <tr>
      <th>fa_args</th>
      <td><p>A list of additional parameters to pass to
<code>fa_func</code>.</p></td>
    </tr>
    <tr>
      <th>cov_of_interest</th>
      <td><p>A vector of positive integers. The column
numbers of the covariates in X whose coefficients you are
interested in. The rest are considered nuisance parameters and
are regressed out by OLS.</p></td>
    </tr>
    <tr>
      <th>include_intercept</th>
      <td><p>A logical. If <code>TRUE</code>, then it will
check <code>X</code> to see if it has an intercept term. If not, then
it will add an intercept term. If <code>FALSE</code>, then <code>X</code>
will be unchanged.</p></td>
    </tr>
    <tr>
      <th>return_mcmc</th>
      <td><p>A logical. Should we return the MCMC draws?</p></td>
    </tr>
    <tr>
      <th>prior_fun</th>
      <td><p>A function. This should take as input a matrix
called <code>beta_mat</code> and output a positive numeric (if
<code>return_log = TRUE</code>) or any numeric (if <code>return_log =
FALSE</code>). This is the prior density (or log-density) of
<code>beta_mat</code>.  Additional arguments may be passed to
<code>prior_fun</code> through the <code>prior_args</code> argument. The
default is to use an improper non-informative uniform prior,
which is guaranteed to result in a proper posterior no matter
the model for the unwanted variation. Type in R
<code><a href='../articles/custom_prior.html'>utils::vignette("custom_prior", package = "vicar")</a></code> for
instructions and examples.</p></td>
    </tr>
    <tr>
      <th>prior_args</th>
      <td><p>A list of arguments to pass to <code>prior_fun</code>.</p></td>
    </tr>
    <tr>
      <th>return_log</th>
      <td><p>A logical. Does <code>prior_fun</code> return the log
of the density (<code>"TRUE"</code>) or not (<code>"FALSE"</code>)? For
numerical stability reasons, you should probably make
<code>prior_fun</code> return the log of the density and set this to
<code>"TRUE"</code>.</p></td>
    </tr>
    <tr>
      <th>pad_na</th>
      <td><p>A logical. Should the indexing of the posterior summaries
be the same as the data (<code>TRUE</code>) or should the control genes
be removed (<code>FALSE</code>)?</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with with some or all of the following elements.</p>
<p><code>means</code> The posterior means of the betas.</p>
<p><code>sd</code> The posterior standard deviations of the betas.</p>
<p><code>medians</code> The posterior medians of the betas</p>
<p><code>upper</code> The posterior 97.5th percentile of the betas.</p>
<p><code>lower</code> The posterior 2.5th percentile of the betas.</p>
<p><code>lfsr1</code> The empirical local false sign rate. This just
    counts the number of betas that are less than 0 before
    calculating lfsr. For the most significant genes, you should probably
    use <code>lfsr2</code>.</p>
<p><code>lfsr2</code> The normal approximation for local false sign
    rate. This approximates the posterior of each beta by a normal,
    then uses this approximation to calculate lfsr.</p>
<p><code>t</code> The posterior means divided by the posterior standard
    deviations.</p>
<p><code>svalues1</code> The svalues from lfsr1. For the most significant
    genes, you should probably use <code>svalues2</code>.</p>
<p><code>svalues2</code> The svalues from lfsr2.</p>
<p><code>betahat_post</code> An array of the posterior samples of the
    betas. Only returned if <code>return_mcmc</code> is <code>TRUE</code>.</p>
<p><code>fa</code> The raw output from whatever factor analysis is
    used. Only returned if <code>return_mcmc</code> is <code>TRUE</code>.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The model is $$Y = XB + ZA + E,$$ where \(Y\) is a matrix of
responses (e.g. log-transformed gene expression levels), \(X\) is
a matrix of covariates, \(B\) is a matrix of coefficients,
\(Z\) is a matrix of unobserved confounders, \(A\) is a matrix
of unobserved coefficients of the unobserved confounders, and
\(E\) is the noise matrix where the elements are independent
Gaussian and each column shares a common variance. The rows of
\(Y\) are the observations (e.g. individuals) and the columns of
\(Y\) are the response variables (e.g. genes).</p>
<p>I have three versions of Bayesian factor analyses that I
recommend. The first is <code><a href='bfa_gs_linked.html'>bfa_gs_linked</a></code>. This version
links the variances between the factors and observations and is the
version used in Gerard and Stephens (2021). This version appears to
work the best in practice and is thus the default. The second,
<code><a href='bfa_gs.html'>bfa_gs</a></code>, is the same as the first except it does not
link the variances between the factors and the observations. The
last is <code>bfa_wrapper</code>, which is just a wrapper for the R
package bfa. The main thing about this version is that they do not
use a hierarchical prior on the variances.</p>
<p>The user can specify their own Bayesian factor analysis (or
Bayesian model for missing data) using the <code>fa_func</code> and
<code>fa_args</code> parameters. To see instructions and examples on how
to do this, type the following in R:
<code><a href='../articles/customFA.html'>utils::vignette("customFA", package = "vicar")</a></code>. If you see
an error in the above code, then this probably means that the
vignettes were not built during installation. In which case, see
<a href='https://github.com/dcgerard/vicar#vignettes'>https://github.com/dcgerard/vicar#vignettes</a>.</p>
<p>The user can also specify their own priors for the second step of
RUVB. To do so, use the parameters <code>prior_fun</code> and
<code>prior_args</code>. To see instructions and an example on how to do
this, run the following code in R:
<code><a href='../articles/custom_prior.html'>utils::vignette("custom_prior", package = "vicar")</a></code>.  Again,
if you see an error in the above code then you probably need to
build the vignettes. Go to
<a href='https://github.com/dcgerard/vicar#vignettes'>https://github.com/dcgerard/vicar#vignettes</a> for
instructions. If a prior is not specified, then the default is to
use a non-informative uniform prior. Though improper, using this
prior will result in a proper posterior no matter the model for the
unwanted variation.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ul>
<li><p>Gerard, David, and Matthew Stephens. 2021. "Unifying and Generalizing Methods for Removing Unwanted Variation Based on Negative Controls." <em>Statistica Sinica</em>, 31(3), 1-22. doi: <a href='https://doi.org/10.5705/ss.202018.0345'>10.5705/ss.202018.0345</a></p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='bfa_gs.html'>bfa_gs</a></code>, <code><a href='bfl.html'>bfl</a></code>, and
    <code>bfa_wrapper</code> for implemented Bayesian factor analyses.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>David Gerard</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/dcgerard/vicar'>vicar</a></span><span class='op'>)</span>

<span class='co'>## Generate data and controls ---------------------------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>345</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>13</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>101</span>
<span class='va'>k</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='va'>q</span> <span class='op'>&lt;-</span> <span class='fl'>3</span>
<span class='va'>is_null</span>       <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>FALSE</span>, length <span class='op'>=</span> <span class='va'>p</span><span class='op'>)</span>
<span class='va'>is_null</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>51</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>
<span class='va'>ctl</span>           <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>FALSE</span>, length <span class='op'>=</span> <span class='va'>p</span><span class='op'>)</span>
<span class='va'>ctl</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>37</span><span class='op'>]</span>     <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>

<span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>q</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>B</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>q</span> <span class='op'>*</span> <span class='va'>p</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>q</span><span class='op'>)</span>
<span class='va'>B</span><span class='op'>[</span><span class='fl'>2</span>, <span class='va'>is_null</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
<span class='va'>Z</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'>%*%</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>q</span> <span class='op'>*</span> <span class='va'>k</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>q</span><span class='op'>)</span> <span class='op'>+</span>
     <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>k</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>k</span> <span class='op'>*</span> <span class='va'>p</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>k</span><span class='op'>)</span>
<span class='va'>E</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>p</span>, sd <span class='op'>=</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'>%*%</span> <span class='va'>B</span> <span class='op'>+</span> <span class='va'>Z</span> <span class='op'>%*%</span> <span class='va'>A</span> <span class='op'>+</span> <span class='va'>E</span>

<span class='co'>## Fit RUVB ---------------------------------------------------------------</span>
<span class='co'>## I use a much smaller number of samples than reccommended for time.</span>
<span class='va'>ruvbout</span> <span class='op'>&lt;-</span> <span class='fu'>ruvb</span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>Y</span>, X <span class='op'>=</span> <span class='va'>X</span>, k <span class='op'>=</span> <span class='va'>k</span>, ctl <span class='op'>=</span> <span class='va'>ctl</span>, cov_of_interest <span class='op'>=</span> <span class='fl'>2</span>,
                include_intercept <span class='op'>=</span> <span class='cn'>FALSE</span>,
                fa_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>nsamp <span class='op'>=</span> <span class='fl'>1000</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Progress:
#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |                                                                      |   1%  |                                                                              |=                                                                     |   1%  |                                                                              |=                                                                     |   2%  |                                                                              |==                                                                    |   2%  |                                                                              |==                                                                    |   3%  |                                                                              |==                                                                    |   4%  |                                                                              |===                                                                   |   4%  |                                                                              |===                                                                   |   5%  |                                                                              |====                                                                  |   5%  |                                                                              |====                                                                  |   6%  |                                                                              |=====                                                                 |   6%  |                                                                              |=====                                                                 |   7%  |                                                                              |=====                                                                 |   8%  |                                                                              |======                                                                |   8%  |                                                                              |======                                                                |   9%  |                                                                              |=======                                                               |   9%  |                                                                              |=======                                                               |  10%  |                                                                              |=======                                                               |  11%  |                                                                              |========                                                              |  11%  |                                                                              |========                                                              |  12%  |                                                                              |=========                                                             |  12%  |                                                                              |=========                                                             |  13%  |                                                                              |=========                                                             |  14%  |                                                                              |==========                                                            |  14%  |                                                                              |==========                                                            |  15%  |                                                                              |===========                                                           |  15%  |                                                                              |===========                                                           |  16%  |                                                                              |============                                                          |  16%  |                                                                              |============                                                          |  17%  |                                                                              |============                                                          |  18%  |                                                                              |=============                                                         |  18%  |                                                                              |=============                                                         |  19%  |                                                                              |==============                                                        |  19%  |                                                                              |==============                                                        |  20%  |                                                                              |==============                                                        |  21%  |                                                                              |===============                                                       |  21%  |                                                                              |===============                                                       |  22%  |                                                                              |================                                                      |  22%  |                                                                              |================                                                      |  23%  |                                                                              |================                                                      |  24%  |                                                                              |=================                                                     |  24%  |                                                                              |=================                                                     |  25%  |                                                                              |==================                                                    |  25%  |                                                                              |==================                                                    |  26%  |                                                                              |===================                                                   |  26%  |                                                                              |===================                                                   |  27%  |                                                                              |===================                                                   |  28%  |                                                                              |====================                                                  |  28%  |                                                                              |====================                                                  |  29%  |                                                                              |=====================                                                 |  29%  |                                                                              |=====================                                                 |  30%  |                                                                              |=====================                                                 |  31%  |                                                                              |======================                                                |  31%  |                                                                              |======================                                                |  32%  |                                                                              |=======================                                               |  32%  |                                                                              |=======================                                               |  33%  |                                                                              |=======================                                               |  34%  |                                                                              |========================                                              |  34%  |                                                                              |========================                                              |  35%  |                                                                              |=========================                                             |  35%  |                                                                              |=========================                                             |  36%  |                                                                              |==========================                                            |  36%  |                                                                              |==========================                                            |  37%  |                                                                              |==========================                                            |  38%  |                                                                              |===========================                                           |  38%  |                                                                              |===========================                                           |  39%  |                                                                              |============================                                          |  39%  |                                                                              |============================                                          |  40%  |                                                                              |============================                                          |  41%  |                                                                              |=============================                                         |  41%  |                                                                              |=============================                                         |  42%  |                                                                              |==============================                                        |  42%  |                                                                              |==============================                                        |  43%  |                                                                              |==============================                                        |  44%  |                                                                              |===============================                                       |  44%  |                                                                              |===============================                                       |  45%  |                                                                              |================================                                      |  45%  |                                                                              |================================                                      |  46%  |                                                                              |=================================                                     |  46%  |                                                                              |=================================                                     |  47%  |                                                                              |=================================                                     |  48%  |                                                                              |==================================                                    |  48%  |                                                                              |==================================                                    |  49%  |                                                                              |===================================                                   |  49%  |                                                                              |===================================                                   |  50%  |                                                                              |===================================                                   |  51%  |                                                                              |====================================                                  |  51%  |                                                                              |====================================                                  |  52%  |                                                                              |=====================================                                 |  52%  |                                                                              |=====================================                                 |  53%  |                                                                              |=====================================                                 |  54%  |                                                                              |======================================                                |  54%  |                                                                              |======================================                                |  55%  |                                                                              |=======================================                               |  55%  |                                                                              |=======================================                               |  56%  |                                                                              |========================================                              |  56%  |                                                                              |========================================                              |  57%  |                                                                              |========================================                              |  58%  |                                                                              |=========================================                             |  58%  |                                                                              |=========================================                             |  59%  |                                                                              |==========================================                            |  59%  |                                                                              |==========================================                            |  60%  |                                                                              |==========================================                            |  61%  |                                                                              |===========================================                           |  61%  |                                                                              |===========================================                           |  62%  |                                                                              |============================================                          |  62%  |                                                                              |============================================                          |  63%  |                                                                              |============================================                          |  64%  |                                                                              |=============================================                         |  64%  |                                                                              |=============================================                         |  65%  |                                                                              |==============================================                        |  65%  |                                                                              |==============================================                        |  66%  |                                                                              |===============================================                       |  66%  |                                                                              |===============================================                       |  67%  |                                                                              |===============================================                       |  68%  |                                                                              |================================================                      |  68%  |                                                                              |================================================                      |  69%  |                                                                              |=================================================                     |  69%  |                                                                              |=================================================                     |  70%  |                                                                              |=================================================                     |  71%  |                                                                              |==================================================                    |  71%  |                                                                              |==================================================                    |  72%  |                                                                              |===================================================                   |  72%  |                                                                              |===================================================                   |  73%  |                                                                              |===================================================                   |  74%  |                                                                              |====================================================                  |  74%  |                                                                              |====================================================                  |  75%  |                                                                              |=====================================================                 |  75%  |                                                                              |=====================================================                 |  76%  |                                                                              |======================================================                |  76%  |                                                                              |======================================================                |  77%  |                                                                              |======================================================                |  78%  |                                                                              |=======================================================               |  78%  |                                                                              |=======================================================               |  79%  |                                                                              |========================================================              |  79%  |                                                                              |========================================================              |  80%  |                                                                              |========================================================              |  81%  |                                                                              |=========================================================             |  81%  |                                                                              |=========================================================             |  82%  |                                                                              |==========================================================            |  82%  |                                                                              |==========================================================            |  83%  |                                                                              |==========================================================            |  84%  |                                                                              |===========================================================           |  84%  |                                                                              |===========================================================           |  85%  |                                                                              |============================================================          |  85%  |                                                                              |============================================================          |  86%  |                                                                              |=============================================================         |  86%  |                                                                              |=============================================================         |  87%  |                                                                              |=============================================================         |  88%  |                                                                              |==============================================================        |  88%  |                                                                              |==============================================================        |  89%  |                                                                              |===============================================================       |  89%  |                                                                              |===============================================================       |  90%  |                                                                              |===============================================================       |  91%  |                                                                              |================================================================      |  91%  |                                                                              |================================================================      |  92%  |                                                                              |=================================================================     |  92%  |                                                                              |=================================================================     |  93%  |                                                                              |=================================================================     |  94%  |                                                                              |==================================================================    |  94%  |                                                                              |==================================================================    |  95%  |                                                                              |===================================================================   |  95%  |                                                                              |===================================================================   |  96%  |                                                                              |====================================================================  |  96%  |                                                                              |====================================================================  |  97%  |                                                                              |====================================================================  |  98%  |                                                                              |===================================================================== |  98%  |                                                                              |===================================================================== |  99%  |                                                                              |======================================================================|  99%  |                                                                              |======================================================================| 100%
#&gt; Complete!</div><div class='input'><span class='va'>ruvblfsr</span> <span class='op'>&lt;-</span> <span class='va'>ruvbout</span><span class='op'>$</span><span class='va'>lfsr2</span>

<span class='co'>## Compare to CATE/RUV4 ---------------------------------------------------</span>
<span class='va'>ruv4out</span> <span class='op'>&lt;-</span> <span class='fu'>cate</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/cate/man/cate.html'>cate.fit</a></span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>Y</span>, X.primary <span class='op'>=</span> <span class='va'>X</span><span class='op'>[</span>, <span class='fl'>2</span>, drop <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>]</span>,
                          X.nuis <span class='op'>=</span> <span class='va'>X</span><span class='op'>[</span>, <span class='op'>-</span><span class='fl'>2</span>, drop <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>]</span>, r <span class='op'>=</span> <span class='va'>k</span>, fa.method <span class='op'>=</span> <span class='st'>"pc"</span>,
                          adj.method <span class='op'>=</span> <span class='st'>"nc"</span>, nc <span class='op'>=</span> <span class='va'>ctl</span><span class='op'>)</span>
<span class='va'>ruv4p</span> <span class='op'>&lt;-</span> <span class='va'>ruv4out</span><span class='op'>$</span><span class='va'>beta.p.value</span>
<span class='va'>ruv4p</span><span class='op'>[</span><span class='va'>ctl</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>NA</span>

<span class='co'>## Plot ROC curves --------------------------------------------------------</span>
<span class='va'>order_ruv4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>ruv4p</span>, na.last <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>
<span class='va'>order_ruvb</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>ruvblfsr</span>, na.last <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>

<span class='va'>nnull</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='op'>!</span><span class='va'>ctl</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>nsig</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='op'>!</span><span class='va'>ctl</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>fpr4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruv4</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nnull</span>
<span class='va'>tpr4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruv4</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nsig</span>
<span class='va'>fprb</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruvb</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nnull</span>
<span class='va'>tprb</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruvb</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nsig</span>

<span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>fprb</span>, <span class='va'>tprb</span>, type <span class='op'>=</span> <span class='st'>"l"</span>, xlab <span class='op'>=</span> <span class='st'>"False Positive Rate"</span>,
               ylab <span class='op'>=</span> <span class='st'>"True Positive Rate"</span>, main <span class='op'>=</span> <span class='st'>"ROC Curves"</span>,
               col <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>fpr4</span>, <span class='va'>tpr4</span>, col <span class='op'>=</span> <span class='fl'>4</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomright"</span>, legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"RUVB"</span>, <span class='st'>"RUV4"</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>4</span><span class='op'>)</span>,
                 lty <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
</div><div class='img'><img src='ruvb-1.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Gerard, Peter Carbonetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


