<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Use control genes to estimate hidden confounders and variance
inflation parameter, then run ASH. — ash_ruv2 • vicar</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Use control genes to estimate hidden confounders and variance
inflation parameter, then run ASH. — ash_ruv2" />

<meta property="og:description" content="This model is fit using a two-step approach proposed in
Gagnon-Bartsch et al (2013) modified to include estimating a
variance inflation parameter. Rather than use OLS in the second
step of this two-step procedure, we estimate the coefficients using
Adaptive SHrinkage (ASH) (Stephens, 2016). In the current
implementation, only the coefficients of one covariate can be
estimated using ASH. The rest are regressed out using OLS." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vicar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/customFA.html">Customizable Factor Analyses</a>
    </li>
    <li>
      <a href="../articles/custom_prior.html">Custom Prior for RUVB</a>
    </li>
    <li>
      <a href="../articles/sample_analysis.html">Sample Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dcgerard/vicar">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Use control genes to estimate hidden confounders and variance
inflation parameter, then run ASH.</h1>
    <small class="dont-index">Source: <a href='https://github.com/dcgerard/vicar/blob/master/R/ash_wrap.R'><code>R/ash_wrap.R</code></a></small>
    <div class="hidden name"><code>ash_ruv2.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This model is fit using a two-step approach proposed in
Gagnon-Bartsch et al (2013) modified to include estimating a
variance inflation parameter. Rather than use OLS in the second
step of this two-step procedure, we estimate the coefficients using
Adaptive SHrinkage (ASH) (Stephens, 2016). In the current
implementation, only the coefficients of one covariate can be
estimated using ASH. The rest are regressed out using OLS.</p>
    
    </div>

    <pre class="usage"><span class='fu'>ash_ruv2</span>(<span class='no'>Y</span>, <span class='no'>X</span>, <span class='no'>ctl</span>, <span class='kw'>k</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>cov_of_interest</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>ncol</a></span>(<span class='no'>X</span>),
  <span class='kw'>likelihood</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"t"</span>, <span class='st'>"normal"</span>), <span class='kw'>ash_args</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(),
  <span class='kw'>limmashrink</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>degrees_freedom</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>include_intercept</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>gls</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>fa_func</span> <span class='kw'>=</span> <span class='no'>pca_2step</span>,
  <span class='kw'>fa_args</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(), <span class='kw'>use_factor</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>A matrix of numerics. These are the response variables
where each column has its own variance. In a gene expression
study, the rows are the individuals and the columns are the
genes.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>A matrix of numerics. The covariates of interest.</p></td>
    </tr>
    <tr>
      <th>ctl</th>
      <td><p>A vector of logicals of length <code><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>ncol(Y)</a></code>. If
position i is <code>TRUE</code> then position i is considered a
negative control.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>A non-negative integer.The number of unobserved
confounders. If not specified and the R package sva is
installed, then this function will estimate the number of
hidden confounders using the methods of Buja and Eyuboglu
(1992).</p></td>
    </tr>
    <tr>
      <th>cov_of_interest</th>
      <td><p>A positive integer. The column number of the
covariate in X whose coefficients you are interested in. The
rest are considered nuiszance parameters and are regressed out
by OLS. <code>ash_ruv2</code> only works with one covariate of
interest right now.</p></td>
    </tr>
    <tr>
      <th>likelihood</th>
      <td><p>Either <code>"normal"</code> or <code>"t"</code>. If
<code>likelihood = "t"</code>, then the user may provide the degrees
of freedom via <code>degrees_freedom</code>.</p></td>
    </tr>
    <tr>
      <th>ash_args</th>
      <td><p>A list of arguments to pass to ash. See
<code><a href='https://www.rdocumentation.org/packages/ashr/topics/ash'>ash.workhorse</a></code> for details.</p></td>
    </tr>
    <tr>
      <th>limmashrink</th>
      <td><p>A logical. Should we apply hierarchical
shrinkage to the variances (<code>TRUE</code>) or not (<code>FALSE</code>)?
If <code>degrees_freedom = NULL</code> and <code>limmashrink = TRUE</code>
and <code>likelihood = "t"</code>, then we'll also use the limma
returned degrees of freedom.</p></td>
    </tr>
    <tr>
      <th>degrees_freedom</th>
      <td><p>if <code>likelihood = "t"</code>, then this is the
user-defined degrees of freedom for that distribution. If
<code>degrees_freedom</code> is <code>NULL</code> then the degrees of
freedom will be the sample size minus the number of covariates
minus <code>k</code>.</p></td>
    </tr>
    <tr>
      <th>include_intercept</th>
      <td><p>A logical. If <code>TRUE</code>, then it will
check <code>X</code> to see if it has an intercept term. If not, then
it will add an intercept term. If <code>FALSE</code>, then <code>X</code>
will be unchanged.</p></td>
    </tr>
    <tr>
      <th>gls</th>
      <td><p>A logical. Should we use generalized least squares
(<code>TRUE</code>) or ordinary least squares (<code>FALSE</code>) for
estimating the confounders? The OLS version is equivalent to
using RUV4 to estimate the confounders.</p></td>
    </tr>
    <tr>
      <th>fa_func</th>
      <td><p>A factor analysis function. The function must have
as inputs a numeric matrix <code>Y</code> and a rank (numeric scalar)
<code>r</code>. It must output numeric matrices <code>alpha</code> and
<code>Z</code> and a numeric vector <code>sig_diag</code>. <code>alpha</code> is
the estimate of the coefficients of the unobserved confounders,
so it must be an <code>r</code> by <code><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>ncol(Y)</a></code> matrix. <code>Z</code>
must be an <code>r</code> by <code><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>nrow(Y)</a></code> matrix. <code>sig_diag</code>
is the estimate of the column-wise variances so it must be of
length <code><a href='https://www.rdocumentation.org/packages/base/topics/nrow'>ncol(Y)</a></code>. The default is the function
<code>pca_naive</code> that just uses the first <code>r</code> singular
vectors as the estimate of <code>alpha</code>. The estimated
variances are just the column-wise mean square.</p></td>
    </tr>
    <tr>
      <th>fa_args</th>
      <td><p>A list. Additional arguments you want to pass to
fa_func.</p></td>
    </tr>
    <tr>
      <th>use_factor</th>
      <td><p>A logical. Should we use the estimates of
<code>alpha</code> and <code>sig_diag</code> from the factor analysis
(<code>TRUE</code>), or re-estimate these using OLS as RUV2 does it
(<code>FALSE</code>)? Right now it's probably a bad idea to have the
settings <code>use_factor = TRUE, fa_limmashrink = TRUE,
limmashrink = TRUE</code> since then the variance estimates of the
control genes are being shrunk twice.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Except for the list <code>ruv2</code>, the values returned are
    the exact same as in <code><a href='https://www.rdocumentation.org/packages/ashr/topics/ash'>ash.workhorse</a></code>. See that
    function for more details. Elements in the <code>ruv2</code> are the
    exact same as returned in <code><a href='vruv2.html'>vruv2</a></code>.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Gagnon-Bartsch, J., Laurent Jacob, and Terence
    P. Speed. "Removing unwanted variation from high dimensional
    data with negative controls."
    Berkeley: Department of Statistics. University of California
    (2013).</p>
<p>Andreas Buja and Nermin
    Eyuboglu. "Remarks on parallel analysis." Multivariate behavior
    research, 27(4):509-540, 1992.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='vruv2.html'>vruv2</a></code> for the variance inflation in RUV2 and
    <code><a href='https://www.rdocumentation.org/packages/ashr/topics/ash'>ash.workhorse</a></code> for the adaptive shrinkage
    method.</p></div>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
          </ul>

    <h2>Author</h2>
    <p>David Gerard</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by David Gerard, Peter Carbonetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.2.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

