<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Removing Unwanted Variation 3. — ruv3 • vicar</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Removing Unwanted Variation 3. — ruv3" />
<meta property="og:description" content="RUV2 (RUV2) and RUV4 (cate or RUV4)
are actually classes of methods indexed by the factor analysis used. RUV3 is the intersection of
RUV2 and RUV4. That is, it is the class of methods that can be considered both RUV2 and RUV4." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vicar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1-11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/customFA.html">Customizable Factor Analyses</a>
    </li>
    <li>
      <a href="../articles/custom_prior.html">Custom Prior for RUVB</a>
    </li>
    <li>
      <a href="../articles/sample_analysis.html">Sample Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://github.com/dcgerard/vicar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Removing Unwanted Variation 3.</h1>
    <small class="dont-index">Source: <a href='http://github.com/dcgerard/vicar/blob/master/R/ruv3.R'><code>R/ruv3.R</code></a></small>
    <div class="hidden name"><code>ruv3.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>RUV2 (<code><a href='https://rdrr.io/pkg/ruv/man/RUV2.html'>RUV2</a></code>) and RUV4 (<code><a href='https://rdrr.io/pkg/cate/man/cate.html'>cate</a></code> or <code><a href='https://rdrr.io/pkg/ruv/man/RUV4.html'>RUV4</a></code>)
are actually classes of methods indexed by the factor analysis used. RUV3 is the intersection of
RUV2 and RUV4. That is, it is the class of methods that can be considered both RUV2 and RUV4.</p>
    </div>

    <pre class="usage"><span class='fu'>ruv3</span><span class='op'>(</span>
  <span class='va'>Y</span>,
  <span class='va'>X</span>,
  <span class='va'>ctl</span>,
  k <span class='op'>=</span> <span class='cn'>NULL</span>,
  cov_of_interest <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>X</span><span class='op'>)</span>,
  include_intercept <span class='op'>=</span> <span class='cn'>TRUE</span>,
  limmashrink <span class='op'>=</span> <span class='cn'>TRUE</span>,
  gls <span class='op'>=</span> <span class='cn'>TRUE</span>,
  fa_func <span class='op'>=</span> <span class='va'>pca_naive</span>,
  fa_args <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Y</th>
      <td><p>A matrix of numerics. These are the response variables
where each column has its own variance. In a gene expression
study, the rows are the individuals and the columns are the
genes.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>A matrix of numerics. The covariates of interest.</p></td>
    </tr>
    <tr>
      <th>ctl</th>
      <td><p>A vector of logicals of length <code><a href='https://rdrr.io/r/base/nrow.html'>ncol(Y)</a></code>. If
position i is <code>TRUE</code> then position i is considered a
negative control.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>A non-negative integer.The number of unobserved
confounders. If not specified and the R package sva is
installed, then this function will estimate the number of
hidden confounders using the methods of Buja and Eyuboglu
(1992).</p></td>
    </tr>
    <tr>
      <th>cov_of_interest</th>
      <td><p>A vector of positive integers. The column
numbers of the covariates in X whose coefficients you are
interested in. The rest are considered nuisance parameters and
are regressed out by OLS.</p></td>
    </tr>
    <tr>
      <th>include_intercept</th>
      <td><p>A logical. If <code>TRUE</code>, then it will
check <code>X</code> to see if it has an intercept term. If not, then
it will add an intercept term. If <code>FALSE</code>, then <code>X</code>
will be unchanged.</p></td>
    </tr>
    <tr>
      <th>limmashrink</th>
      <td><p>A logical. Should we apply hierarchical
shrinkage to the variances (<code>TRUE</code>) or not (<code>FALSE</code>)?
If <code>degrees_freedom = NULL</code> and <code>limmashrink = TRUE</code>
and <code>likelihood = "t"</code>, then we'll also use the limma
returned degrees of freedom.</p></td>
    </tr>
    <tr>
      <th>gls</th>
      <td><p>A logical. Should we use generalized least squares
(<code>TRUE</code>) or ordinary least squares (<code>FALSE</code>) for
estimating the confounders? The OLS version is equivalent to
using RUV4 to estimate the confounders.</p></td>
    </tr>
    <tr>
      <th>fa_func</th>
      <td><p>A factor analysis function. The function must have
as inputs a numeric matrix <code>Y</code> and a rank (numeric scalar)
<code>r</code>. It must output numeric matrices <code>alpha</code> and
<code>Z</code> and a numeric vector <code>sig_diag</code>. <code>alpha</code> is
the estimate of the coefficients of the unobserved confounders,
so it must be an <code>r</code> by <code><a href='https://rdrr.io/r/base/nrow.html'>ncol(Y)</a></code> matrix. <code>Z</code>
must be an <code>r</code> by <code><a href='https://rdrr.io/r/base/nrow.html'>nrow(Y)</a></code> matrix. <code>sig_diag</code>
is the estimate of the column-wise variances so it must be of
length <code><a href='https://rdrr.io/r/base/nrow.html'>ncol(Y)</a></code>. The default is the function
<code>pca_naive</code> that just uses the first <code>r</code> singular
vectors as the estimate of <code>alpha</code>. The estimated
variances are just the column-wise mean square.</p></td>
    </tr>
    <tr>
      <th>fa_args</th>
      <td><p>A list. Additional arguments you want to pass to
fa_func.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>betahat</code> The estimates of the coefficients of
    interest. The values corresponding to control genes are 0.</p>
<p><code>sebetahat_unadjusted</code> The unadjusted standard errors of
    <code>betahat</code>. The values corresponding to control genes are
    <code>NA</code>.</p>
<p><code>tstats_unadjusted</code> The t-statistics corresponding to the
    coefficients of interest. These use <code>sebetahat_unadjusted</code>
    as the standard errors. The values corresponding to control
    genes are <code>NA</code>.</p>
<p><code>pvalues_unadjusted</code> The p-values using said statistics
    above.</p>
<p><code>sebetahat_adjusted</code> The unadjusted standard errors of
    <code>betahat</code>. This equals <code>sebetahat_unadjusted *
    multiplier</code>. The values corresponding to control genes are
    <code>NA</code>.</p>
<p><code>tstats_adjusted</code> The t-statistics corresponding to the
    coefficients of interest. These use <code>sebetahat_adjusted</code>
    as the standard errors. The values corresponding to control
    genes are <code>NA</code>.</p>
<p><code>pvalues_unadjusted</code> The p-values using said statistics
    above.</p>
<p><code>betahat_ols</code> The ordinary least squares (OLS) estimates
    for all of the coefficients.</p>
<p><code>sebetahat_ols</code> The standard errors from OLS regression.</p>
<p><code>tstats_ols</code> The t-statistics from OLS regression.</p>
<p><code>pvalues_ols</code> The p-values from OLS regression.</p>
<p><code>sigma2_unadjusted</code> The unadjusted variance estimates.</p>
<p><code>sigma2_adjusted</code> The adjusted variance estimates. This is
    equal to <code>sigma2_unadjusted * multiplier</code>.</p>
<p><code>Zhat</code> The estimates of the confounders.</p>
<p><code>alphahat</code> The estimates of the coefficients of the confounders.</p>
<p><code>multiplier</code> The estimate of the variance inflation parameter.</p>
<p><code>mult_matrix</code> The unscaled covariance of <code>betahat</code>
    after including the confounders.</p>
<p><code>mult_matrix_ols</code> The OLS version of <code>mult_matrix</code>.</p>
<p><code>degrees_freedom</code> The degrees of freedom used when
    calculating the p-values.</p>
<p><code>debuglist</code> A list of elements that aren't really useful
    except for unit testing and debugging.</p>
<p><code>resid_mat</code>  Y21 - Z2 <!-- %*% alpha1 --></p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The model is $$Y = XB + ZA + E,$$ where \(Y\) is a matrix of
responses (e.g. log-transformed gene expression levels), \(X\) is
a matrix of covariates, \(B\) is a matrix of coefficients,
\(Z\) is a matrix of unobserved confounders, \(A\) is a matrix
of unobserved coefficients of the unobserved confounders, and
\(E\) is the noise matrix where the elements are independent
Gaussian and each column shares a common variance. The rows of
\(Y\) are the observations (e.g. individuals) and the columns of
\(Y\) are the response variables (e.g. genes).</p>
<p>For instructions and examples on how to specify your own factor analysis, run the following code in R:
<code><a href='../articles/customFA.html'>utils::vignette("customFA", package = "vicar")</a></code>. If it doesn't work, then you probably haven't built
the vignettes. To do so, see <a href='https://github.com/dcgerard/vicar#vignettes'>https://github.com/dcgerard/vicar#vignettes</a>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ul>
<li><p>Gerard, David, and Matthew Stephens. 2021. "Unifying and Generalizing Methods for Removing Unwanted Variation Based on Negative Controls." <em>Statistica Sinica</em>, 31(3), 1145-1166. doi: <a href='https://doi.org/10.5705/ss.202018.0345'>10.5705/ss.202018.0345</a></p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='vruv4.html'>vruv4</a></code>, <code><a href='https://rdrr.io/pkg/cate/man/cate.html'>cate</a></code>, <code><a href='https://rdrr.io/pkg/ruv/man/RUV4.html'>RUV4</a></code> are
    all different versions of RUV4.</p>
<p><code><a href='https://rdrr.io/pkg/ruv/man/RUV2.html'>RUV2</a></code> is a version of RUV2.</p>
<p><code><a href='ruvimpute.html'>ruvimpute</a></code> is a generalization of RUV2 and RUV4.</p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>David Gerard</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/dcgerard/vicar'>vicar</a></span><span class='op'>)</span>

<span class='co'>## Generate data and controls ---------------------------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>127</span><span class='op'>)</span>
<span class='va'>n</span> <span class='op'>&lt;-</span> <span class='fl'>13</span>
<span class='va'>p</span> <span class='op'>&lt;-</span> <span class='fl'>201</span>
<span class='va'>k</span> <span class='op'>&lt;-</span> <span class='fl'>2</span>
<span class='va'>q</span> <span class='op'>&lt;-</span> <span class='fl'>3</span>
<span class='va'>is_null</span>       <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>FALSE</span>, length <span class='op'>=</span> <span class='va'>p</span><span class='op'>)</span>
<span class='va'>is_null</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>101</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>
<span class='va'>ctl</span>           <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>FALSE</span>, length <span class='op'>=</span> <span class='va'>p</span><span class='op'>)</span>
<span class='va'>ctl</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>73</span><span class='op'>]</span>     <span class='op'>&lt;-</span> <span class='cn'>TRUE</span>

<span class='va'>X</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>q</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>B</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>q</span> <span class='op'>*</span> <span class='va'>p</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>q</span><span class='op'>)</span>
<span class='va'>B</span><span class='op'>[</span><span class='fl'>2</span>, <span class='va'>is_null</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fl'>0</span>
<span class='va'>Z</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'>%*%</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>q</span> <span class='op'>*</span> <span class='va'>k</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>q</span><span class='op'>)</span> <span class='op'>+</span>
     <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>k</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>k</span> <span class='op'>*</span> <span class='va'>p</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>k</span><span class='op'>)</span>
<span class='va'>E</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>*</span> <span class='va'>p</span>, sd <span class='op'>=</span> <span class='fl'>1</span> <span class='op'>/</span> <span class='fl'>2</span><span class='op'>)</span>, nrow <span class='op'>=</span> <span class='va'>n</span><span class='op'>)</span>
<span class='va'>Y</span> <span class='op'>&lt;-</span> <span class='va'>X</span> <span class='op'>%*%</span> <span class='va'>B</span> <span class='op'>+</span> <span class='va'>Z</span> <span class='op'>%*%</span> <span class='va'>A</span> <span class='op'>+</span> <span class='va'>E</span>

<span class='co'>## Fit RUV3, CATE (RUV4), and RUV2 ----------------------------------------</span>
<span class='co'>## The parameters chosen in CATE are to make the comparisons as close as possible.</span>
<span class='va'>ruv3out</span> <span class='op'>&lt;-</span> <span class='fu'>ruv3</span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>Y</span>, X <span class='op'>=</span> <span class='va'>X</span>, k <span class='op'>=</span> <span class='va'>k</span>, cov_of_interest <span class='op'>=</span> <span class='fl'>2</span>,
                include_intercept <span class='op'>=</span> <span class='cn'>FALSE</span>, ctl <span class='op'>=</span> <span class='va'>ctl</span>,
                limmashrink <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>ruv2out</span> <span class='op'>&lt;-</span> <span class='fu'>ruv</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ruv/man/RUV2.html'>RUV2</a></span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>Y</span>, X <span class='op'>=</span> <span class='va'>X</span><span class='op'>[</span>, <span class='fl'>2</span>, drop <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>]</span>,
                     Z <span class='op'>=</span> <span class='va'>X</span><span class='op'>[</span>, <span class='op'>-</span><span class='fl'>2</span>, drop <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>]</span>, ctl <span class='op'>=</span> <span class='va'>ctl</span>, k <span class='op'>=</span> <span class='va'>k</span><span class='op'>)</span>
<span class='va'>ruv4out</span> <span class='op'>&lt;-</span> <span class='fu'>cate</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/cate/man/cate.html'>cate.fit</a></span><span class='op'>(</span>Y <span class='op'>=</span> <span class='va'>Y</span>, X.primary <span class='op'>=</span> <span class='va'>X</span><span class='op'>[</span>, <span class='fl'>2</span>, drop <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>]</span>,
                     X.nuis <span class='op'>=</span> <span class='va'>X</span><span class='op'>[</span>, <span class='op'>-</span><span class='fl'>2</span>, drop <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>]</span>, r <span class='op'>=</span> <span class='va'>k</span>, fa.method <span class='op'>=</span> <span class='st'>"pc"</span>,
                     adj.method <span class='op'>=</span> <span class='st'>"nc"</span>, nc <span class='op'>=</span> <span class='va'>ctl</span>, calibrate <span class='op'>=</span> <span class='cn'>FALSE</span>,
                     nc.var.correction <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>

<span class='va'>ruv3p</span> <span class='op'>&lt;-</span> <span class='va'>ruv3out</span><span class='op'>$</span><span class='va'>pvalues_unadjusted</span>
<span class='va'>ruv2p</span> <span class='op'>&lt;-</span> <span class='va'>ruv2out</span><span class='op'>$</span><span class='va'>p</span>
<span class='va'>ruv4p</span> <span class='op'>&lt;-</span> <span class='va'>ruv4out</span><span class='op'>$</span><span class='va'>beta.p.value</span>

<span class='co'>## Control genes are known to be 0! ---------------------------------------</span>
<span class='va'>ruv2p</span><span class='op'>[</span><span class='va'>ctl</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>NA</span>
<span class='va'>ruv4p</span><span class='op'>[</span><span class='va'>ctl</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>NA</span>

<span class='co'>## Plot ROC curves are very similar in this dataset------------------------</span>
<span class='va'>order_ruv3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>ruv3p</span>, na.last <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>
<span class='va'>order_ruv2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>ruv2p</span>, na.last <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>
<span class='va'>order_ruv4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/order.html'>order</a></span><span class='op'>(</span><span class='va'>ruv4p</span>, na.last <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>

<span class='va'>nnull</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='op'>!</span><span class='va'>ctl</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>nsig</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='op'>!</span><span class='va'>ctl</span><span class='op'>]</span><span class='op'>)</span>
<span class='va'>fpr3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruv3</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nnull</span>
<span class='va'>tpr3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruv3</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nsig</span>

<span class='va'>fpr2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruv2</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nnull</span>
<span class='va'>tpr2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruv2</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nsig</span>

<span class='va'>fpr4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruv4</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nnull</span>
<span class='va'>tpr4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='op'>!</span><span class='va'>is_null</span><span class='op'>[</span><span class='va'>order_ruv4</span><span class='op'>]</span><span class='op'>)</span> <span class='op'>/</span> <span class='va'>nsig</span>

<span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>fpr3</span>, <span class='va'>tpr3</span>, type <span class='op'>=</span> <span class='st'>"l"</span>, xlab <span class='op'>=</span> <span class='st'>"False Positive Rate"</span>,
               ylab <span class='op'>=</span> <span class='st'>"True Positive Rate"</span>, main <span class='op'>=</span> <span class='st'>"ROC Curves"</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>fpr2</span>, <span class='va'>tpr2</span>, col <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>fpr4</span>, <span class='va'>tpr4</span>, col <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span>
</div><div class='input'><span class='fu'>graphics</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"bottomright"</span>, legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"RUV2"</span>, <span class='st'>"RUV3"</span>, <span class='st'>"RUV4"</span><span class='op'>)</span>,
                 col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>4</span><span class='op'>)</span>, lty <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='img'><img src='ruv3-1.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Gerard, Peter Carbonetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


