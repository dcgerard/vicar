<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sample Analysis • vicar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sample Analysis">
<meta property="og:description" content="vicar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vicar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1-11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/customFA.html">Customizable Factor Analyses</a>
    </li>
    <li>
      <a href="../articles/custom_prior.html">Custom Prior for RUVB</a>
    </li>
    <li>
      <a href="../articles/sample_analysis.html">Sample Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/dcgerard/vicar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="sample_analysis_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sample Analysis</h1>
                        <h4 class="author">David Gerard</h4>
            
            <h4 class="date">2021-04-29</h4>
      
      <small class="dont-index">Source: <a href="http://github.com/dcgerard/vicar/blob/master/vignettes/sample_analysis.Rmd"><code>vignettes/sample_analysis.Rmd</code></a></small>
      <div class="hidden name"><code>sample_analysis.Rmd</code></div>

    </div>

    
    
<div id="abstract" class="section level1">
<h1 class="hasAnchor">
<a href="#abstract" class="anchor"></a>Abstract</h1>
<p>In this vignette, I take an example simulated RNA-seq dataset and analyze it using the functions in the vicar R package. I compare their performances against the methods available in other packages. The methods in vicar are described in detail in <span class="citation">Gerard and Stephens (2020)</span> and <span class="citation">Gerard and Stephens (2021)</span>.</p>
</div>
<div id="data" class="section level1">
<h1 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h1>
<p>The data are simulated RNA-seq expression data based on the characteristics of the GTEx data: . The overall model for these data is <span class="math display">\[
Y = X\beta + Z\alpha + E,
\]</span> where <span class="math inline">\(Y\)</span> contains the gene expression levels, <span class="math inline">\(X\)</span> contains the observed covariates, <span class="math inline">\(\beta\)</span> contains the coefficients of the observed covariates, <span class="math inline">\(Z\)</span> contains the unobserved confounders, <span class="math inline">\(\alpha\)</span> contains the coefficients of the unobserved confounders, and <span class="math inline">\(E\)</span> contains independent Gaussian noise with column-specific variances. The data, <code>sim_gtex</code> consists of a list of elements:</p>
<ul>
<li>
<code>Y</code> A matrix of gene expression levels. The rows index the samples and the columns index the genes.</li>
<li>
<code>X</code> A matrix of covariates. The first column is simply for an intercept term and the second column is a group indicator.</li>
<li>
<code>beta</code> The known signal for the group indicator.</li>
<li>
<code>ctl</code> A logical vector indicating the location of control genes.</li>
<li>
<code>which_null</code> A logical vector indicating the location of null genes.</li>
</ul>
<p>I’ve added signal to the <code>Y</code> matrix, the amount of which is encoded in the vector <code>beta</code>. We can read in these data using the <code>data</code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dcgerard/vicar">vicar</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">sim_gtex</span><span class="op">)</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">sim_gtex</span><span class="op">$</span><span class="va">Y</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="va">sim_gtex</span><span class="op">$</span><span class="va">X</span>
<span class="va">ctl</span> <span class="op">&lt;-</span> <span class="va">sim_gtex</span><span class="op">$</span><span class="va">ctl</span>
<span class="va">which_null</span> <span class="op">&lt;-</span> <span class="va">sim_gtex</span><span class="op">$</span><span class="va">which_null</span>
<span class="va">beta</span> <span class="op">&lt;-</span> <span class="va">sim_gtex</span><span class="op">$</span><span class="va">beta</span></code></pre></div>
<p>These data contain 20 samples and 1000 genes. The proportion of genes in these data that are null is 0.9. However, we only allow 10 of these genes to be known as negative controls.</p>
<p>Before we proceed with the analysis, we note that all confounder adjustment methods we explore require an estimate of the number of hidden confounders. We can use the <code>num.sv</code> function in the sva package to obtain this estimate. It has different approaches to estimate the number of hidden factors, and each says that there are about 3 hidden factors.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num_sv</span>     <span class="op">&lt;-</span> <span class="fu">sva</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sva/man/num.sv.html">num.sv</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, mod <span class="op">=</span> <span class="va">X</span>, method <span class="op">=</span> <span class="st">"be"</span><span class="op">)</span>
<span class="va">num_sv_l</span>   <span class="op">&lt;-</span> <span class="fu">sva</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sva/man/num.sv.html">num.sv</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, mod <span class="op">=</span> <span class="va">X</span>, method <span class="op">=</span> <span class="st">"leek"</span><span class="op">)</span>
<span class="va">num_sv</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num_sv_l</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="analysis-with-controls" class="section level1">
<h1 class="hasAnchor">
<a href="#analysis-with-controls" class="anchor"></a>Analysis With Controls</h1>
<p>When there are control genes, there are many options to analyze your data. vicar, cate, and ruv all have their different versions of RUV4. We’ll just look at the default settings for each.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ruv4_vicar</span> <span class="op">&lt;-</span> <span class="fu">vicar</span><span class="fu">::</span><span class="fu"><a href="../reference/vruv4.html">vruv4</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, k <span class="op">=</span> <span class="va">num_sv</span>, ctl <span class="op">=</span> <span class="va">ctl</span>, cov_of_interest <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">ruv4_cate</span>  <span class="op">&lt;-</span> <span class="fu">cate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cate/man/cate.html">cate.fit</a></span><span class="op">(</span>X.primary <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, X.nuis <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,
                             Y <span class="op">=</span> <span class="va">Y</span>, r <span class="op">=</span> <span class="va">num_sv</span>, adj.method <span class="op">=</span> <span class="st">"nc"</span>, nc <span class="op">=</span> <span class="va">ctl</span><span class="op">)</span>
<span class="va">ruv4_ruv</span>   <span class="op">&lt;-</span> <span class="fu">ruv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ruv/man/RUV4.html">RUV4</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, ctl <span class="op">=</span> <span class="va">ctl</span>, k <span class="op">=</span> <span class="va">num_sv</span>,
                        Z <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>The ruv package also implements the RUV2 method.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ruv2_ruv</span> <span class="op">&lt;-</span> <span class="fu">ruv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ruv/man/RUV2.html">RUV2</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, ctl <span class="op">=</span> <span class="va">ctl</span>, k <span class="op">=</span> <span class="va">num_sv</span>,
                      Z <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>A method that is both a version of RUV2 and a version of RUV4 is implemented in the vicar function <code>ruv3</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ruv3_vicar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ruv3.html">ruv3</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, k <span class="op">=</span> <span class="va">num_sv</span>, ctl <span class="op">=</span> <span class="va">ctl</span>, cov_of_interest <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Finally, a Bayesian version of RUV is implemented in the vicar function <code>ruvb</code>. I run the Gibbs sampler for much fewer iterations than what you should do in practice.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ruvb_vicar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ruvb.html">ruvb</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, ctl <span class="op">=</span> <span class="va">ctl</span>, k <span class="op">=</span> <span class="va">num_sv</span>, cov_of_interest <span class="op">=</span> <span class="fl">2</span>,
                   fa_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>display_progress <span class="op">=</span> <span class="cn">FALSE</span>, nsamp <span class="op">=</span> <span class="fl">1000</span>, thin <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="analysis-without-controls" class="section level1">
<h1 class="hasAnchor">
<a href="#analysis-without-controls" class="anchor"></a>Analysis Without Controls</h1>
<p>When control genes are not present, there are still plenty of options. Two implementations in vicar are <code>mouthwash</code> and <code>backwash</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mout</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mouthwash.html">mouthwash</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, k <span class="op">=</span> <span class="va">num_sv</span>, cov_of_interest <span class="op">=</span> <span class="fl">2</span>, include_intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## Running mouthwash on 20 x 2 matrix X and 20 x 1000 matrix Y.
##  - Computing independent basis using QR decomposition.
##  - Computation took 0.009 seconds.
##  - Running additional preprocessing steps.
##  - Computation took 0.001 seconds.
##  - Running second step of mouthwash:
##     + Estimating model parameters using EM.
##     + Computation took 3.495 seconds.
##     + Generating adaptive shrinkage (ash) output.
##     + Computation took 0.092 seconds.
##  - Second step took 4.075 seconds.
##  - Estimating additional hidden confounders.
##  - Computation took 0.013 seconds.</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bout</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/backwash.html">backwash</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span>, X <span class="op">=</span> <span class="va">X</span>, k <span class="op">=</span> <span class="va">num_sv</span>, cov_of_interest <span class="op">=</span> <span class="fl">2</span>, include_intercept <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>##  - Computing independent basis using QR decomposition.
##  - Computation took 0.01 seconds.
##  - Running additional preprocessing steps.
##  - Computation took 0 seconds.
##  - Running second step of backwash:
##     + Initializing parameters for EM algorithm.
##     + Computation took 0.99 seconds.
##     + Running one round of parameter updates.
##     + Computation took 0.019 seconds.
##     + Estimating model parameters using EM.
##     + Computation took 13.006 seconds.
##     + Generating posterior statistics.
##     + Computation took 0.004 seconds.
##  - Second step took 14.971 seconds.
##  - Generating final backwash outputs.
##  - Computation took 0.012 seconds.</code></pre>
<p>In terms of other packages, you can use the <code>sva</code> function in the sva package, the <code>cate</code> function in the cate package, or the <code>leapp</code> function in the leapp package.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cate_cate</span>   <span class="op">&lt;-</span> <span class="fu">cate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cate/man/cate.html">cate.fit</a></span><span class="op">(</span>X.primary <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, X.nuis <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>,
                              Y <span class="op">=</span> <span class="va">Y</span>, r <span class="op">=</span> <span class="va">num_sv</span>, adj.method <span class="op">=</span> <span class="st">"rr"</span><span class="op">)</span>
<span class="va">leapp_leapp</span> <span class="op">&lt;-</span> <span class="fu">leapp</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/leapp/man/leapp.html">leapp</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, pred.prim <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, 
                            pred.covar <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, num.fac <span class="op">=</span> <span class="va">num_sv</span><span class="op">)</span>

<span class="co">## Recommended pipeline for SVA</span>
<span class="va">sva_sva</span>     <span class="op">&lt;-</span> <span class="fu">sva</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sva/man/sva.html">sva</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, mod <span class="op">=</span> <span class="va">X</span>, mod0 <span class="op">=</span> <span class="va">X</span><span class="op">[</span>, <span class="op">-</span><span class="fl">2</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, n.sv <span class="op">=</span> <span class="va">num_sv</span><span class="op">)</span></code></pre></div>
<pre><code>## Number of significant surrogate variables is:  3 
## Iteration (out of 5 ):1  2  3  4  5</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">X.sva</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">sva_sva</span><span class="op">$</span><span class="va">sv</span><span class="op">)</span>
<span class="va">lmout</span> <span class="op">&lt;-</span> <span class="fu">limma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/lmFit.html">lmFit</a></span><span class="op">(</span>object <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, design <span class="op">=</span> <span class="va">X.sva</span><span class="op">)</span>
<span class="va">eout</span>  <span class="op">&lt;-</span> <span class="fu">limma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/ebayes.html">eBayes</a></span><span class="op">(</span><span class="va">lmout</span><span class="op">)</span>
<span class="va">svaout</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">svaout</span><span class="op">$</span><span class="va">betahat</span>   <span class="op">&lt;-</span> <span class="va">lmout</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>
<span class="va">svaout</span><span class="op">$</span><span class="va">sebetahat</span> <span class="op">&lt;-</span> <span class="va">lmout</span><span class="op">$</span><span class="va">stdev.unscaled</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">eout</span><span class="op">$</span><span class="va">s2.post</span><span class="op">)</span>
<span class="va">svaout</span><span class="op">$</span><span class="va">pvalues</span>   <span class="op">&lt;-</span> <span class="va">eout</span><span class="op">$</span><span class="va">p.value</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>
<span class="co">## Sanity check</span>
<span class="co">## plot(lmout$coefficients[,2] / (lmout$stdev.unscaled[, 2] * sqrt(eout$s2.post)), eout$t[,2])</span></code></pre></div>
</div>
<div id="compare-methods" class="section level1">
<h1 class="hasAnchor">
<a href="#compare-methods" class="anchor"></a>Compare methods</h1>
<p>We’ll compare how all of the methods performed on these data using the <code>pROC</code> package.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">roc_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">mout</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">lfdr</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">bout</span><span class="op">$</span><span class="va">result</span><span class="op">$</span><span class="va">lfdr</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cate_cate</span><span class="op">$</span><span class="va">beta.p.value</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">svaout</span><span class="op">$</span><span class="va">pvalues</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">leapp_leapp</span><span class="op">$</span><span class="va">p</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv2_ruv</span><span class="op">$</span><span class="va">p</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv3_vicar</span><span class="op">$</span><span class="va">pvalues_unadjusted</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv4_vicar</span><span class="op">$</span><span class="va">pvalues</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv4_cate</span><span class="op">$</span><span class="va">beta.p.value</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv4_ruv</span><span class="op">$</span><span class="va">p</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu">pROC</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pROC/man/roc.html">roc</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">which_null</span>, predictor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruvb_vicar</span><span class="op">$</span><span class="va">lfsr2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">name_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"MOUTHWASH"</span>, <span class="st">"BACKWASH"</span>, <span class="st">"CATErr"</span>, <span class="st">"SVA"</span>, <span class="st">"LEAPP"</span>, <span class="st">"RUV2"</span>, <span class="st">"RUV3"</span>, <span class="st">"RUV4v"</span>, <span class="st">"RUV4c"</span>, <span class="st">"RUV4r"</span>, <span class="st">"RUVb"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">roc_out</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">name_vec</span>

<span class="va">sout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">roc_out</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>TPR <span class="op">=</span> <span class="va">x</span><span class="op">$</span><span class="va">sensitivities</span>, FPR <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">$</span><span class="va">specificities</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">index</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">sout</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sout</span><span class="op">[[</span><span class="va">index</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Method</span> <span class="op">&lt;-</span> <span class="va">name_vec</span><span class="op">[</span><span class="va">index</span><span class="op">]</span>
<span class="op">}</span>
<span class="va">longdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">sout</span><span class="op">)</span></code></pre></div>
<p>We’ll first look at the ROC Curves for the methods that use control genes.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shortdat</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">longdat</span>, <span class="va">Method</span> <span class="op">==</span> <span class="st">"RUV2"</span> <span class="op">|</span> <span class="va">Method</span> <span class="op">==</span> <span class="st">"RUV3"</span> <span class="op">|</span> <span class="va">Method</span> <span class="op">==</span> <span class="st">"RUV4v"</span> <span class="op">|</span>
                            <span class="va">Method</span> <span class="op">==</span> <span class="st">"RUV4c"</span> <span class="op">|</span> <span class="va">Method</span> <span class="op">==</span> <span class="st">"RUV4r"</span> <span class="op">|</span> <span class="va">Method</span> <span class="op">==</span> <span class="st">"RUVb"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">shortdat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FPR</span>, y <span class="op">=</span> <span class="va">TPR</span>, col <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"ROC Curves"</span><span class="op">)</span></code></pre></div>
<p><img src="sample_analysis_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>Eyeballing it, it seems that RUV3 and RUV2 perform the best here, though not with regards to the most significant genes. The <code>ruv</code> version of RUV4 appears to do much worse.</p>
<p>Now we’ll look at the ROC curves of methods that do not use control genes.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shortdat</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">longdat</span>, <span class="va">Method</span> <span class="op">==</span> <span class="st">"MOUTHWASH"</span> <span class="op">|</span> <span class="va">Method</span> <span class="op">==</span> <span class="st">"BACKWASH"</span> <span class="op">|</span>
                            <span class="va">Method</span> <span class="op">==</span> <span class="st">"CATErr"</span> <span class="op">|</span> <span class="va">Method</span> <span class="op">==</span> <span class="st">"SVA"</span> <span class="op">|</span> <span class="va">Method</span> <span class="op">==</span> <span class="st">"LEAPP"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">shortdat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FPR</span>, y <span class="op">=</span> <span class="va">TPR</span>, col <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_path</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"ROC Curves"</span><span class="op">)</span></code></pre></div>
<p><img src="sample_analysis_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>Eyeballing it, it seems that MOUTHWASH and BACKWASH do the best over the largest length of the curve. Note that the BACKWASH curve is nearly completely covered by the MOUTHWASH curve.</p>
<p>We can calculate the areas under the curve (AUC) for each method</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">auc_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">roc_out</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="va">x</span><span class="op">$</span><span class="va">auc</span> <span class="op">}</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">auc_vec</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, col.names <span class="op">=</span> <span class="st">"AUC"</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">AUC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">MOUTHWASH</td>
<td align="right">0.892</td>
</tr>
<tr class="even">
<td align="left">BACKWASH</td>
<td align="right">0.891</td>
</tr>
<tr class="odd">
<td align="left">RUV3</td>
<td align="right">0.885</td>
</tr>
<tr class="even">
<td align="left">CATErr</td>
<td align="right">0.884</td>
</tr>
<tr class="odd">
<td align="left">RUV2</td>
<td align="right">0.884</td>
</tr>
<tr class="even">
<td align="left">LEAPP</td>
<td align="right">0.879</td>
</tr>
<tr class="odd">
<td align="left">SVA</td>
<td align="right">0.871</td>
</tr>
<tr class="even">
<td align="left">RUVb</td>
<td align="right">0.864</td>
</tr>
<tr class="odd">
<td align="left">RUV4v</td>
<td align="right">0.859</td>
</tr>
<tr class="even">
<td align="left">RUV4c</td>
<td align="right">0.856</td>
</tr>
<tr class="odd">
<td align="left">RUV4r</td>
<td align="right">0.816</td>
</tr>
</tbody>
</table>
</div>
<div id="estimating-the-proportion-of-genes-that-are-null-" class="section level1">
<h1 class="hasAnchor">
<a href="#estimating-the-proportion-of-genes-that-are-null-" class="anchor"></a>Estimating the proportion of genes that are NULL.</h1>
<p>It is sometimes of interest to estimate the number of genes that show a signal. <code>mouthwash</code> and <code>backwash</code> already return these estimates. For other methods, we can use a summary statistic method (SSM) to get estimates of the proportion of genes that are null. Two useful SSM’s are implemented in the ashr and qvalue R packages. We’ll look at using the ashr package.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">method_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">CATErr</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">CATErr</span><span class="op">$</span><span class="va">betahat</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">cate_cate</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">CATErr</span><span class="op">$</span><span class="va">sebetahat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">cate_cate</span><span class="op">$</span><span class="va">beta.cov.row</span> <span class="op">*</span> <span class="va">cate_cate</span><span class="op">$</span><span class="va">beta.cov.col</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in cate_cate$beta.cov.row * cate_cate$beta.cov.col: Recycling array of length 1 in vector-array arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">method_list</span><span class="op">$</span><span class="va">RUV2</span>            <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV2</span><span class="op">$</span><span class="va">betahat</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv2_ruv</span><span class="op">$</span><span class="va">betahat</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV2</span><span class="op">$</span><span class="va">sebetahat</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">ruv2_ruv</span><span class="op">$</span><span class="va">multiplier</span> <span class="op">*</span> <span class="va">ruv2_ruv</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in ruv2_ruv$multiplier * ruv2_ruv$sigma2: Recycling array of length 1 in array-vector arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">method_list</span><span class="op">$</span><span class="va">RUV3</span>            <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV3</span><span class="op">$</span><span class="va">betahat</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv3_vicar</span><span class="op">$</span><span class="va">betahat</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV3</span><span class="op">$</span><span class="va">sebetahat</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv3_vicar</span><span class="op">$</span><span class="va">sebetahat_unadjusted</span><span class="op">)</span>

<span class="va">method_list</span><span class="op">$</span><span class="va">RUV4r</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV4r</span><span class="op">$</span><span class="va">betahat</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv4_ruv</span><span class="op">$</span><span class="va">betahat</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV4r</span><span class="op">$</span><span class="va">sebetahat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">ruv4_ruv</span><span class="op">$</span><span class="va">multiplier</span> <span class="op">*</span> <span class="va">ruv4_ruv</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in ruv4_ruv$multiplier * ruv4_ruv$sigma2: Recycling array of length 1 in array-vector arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">method_list</span><span class="op">$</span><span class="va">RUV4v</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV4v</span><span class="op">$</span><span class="va">betahat</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv4_vicar</span><span class="op">$</span><span class="va">betahat</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV4v</span><span class="op">$</span><span class="va">sebetahat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv4_vicar</span><span class="op">$</span><span class="va">sebetahat_ols</span><span class="op">)</span>

<span class="va">method_list</span><span class="op">$</span><span class="va">RUV4c</span>           <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV4c</span><span class="op">$</span><span class="va">betahat</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruv4_cate</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUV4c</span><span class="op">$</span><span class="va">sebetahat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">ruv4_cate</span><span class="op">$</span><span class="va">beta.cov.row</span> <span class="op">*</span> <span class="va">ruv4_cate</span><span class="op">$</span><span class="va">beta.cov.col</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in ruv4_cate$beta.cov.row * ruv4_cate$beta.cov.col: Recycling array of length 1 in vector-array arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">method_list</span><span class="op">$</span><span class="va">RUVb</span>            <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUVb</span><span class="op">$</span><span class="va">betahat</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruvb_vicar</span><span class="op">$</span><span class="va">means</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">RUVb</span><span class="op">$</span><span class="va">sebetahat</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ruvb_vicar</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span>

<span class="va">method_list</span><span class="op">$</span><span class="va">SVA</span>             <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">SVA</span><span class="op">$</span><span class="va">betahat</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">svaout</span><span class="op">$</span><span class="va">betahat</span><span class="op">)</span>
<span class="va">method_list</span><span class="op">$</span><span class="va">SVA</span><span class="op">$</span><span class="va">sebetahat</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">svaout</span><span class="op">$</span><span class="va">sebetahat</span><span class="op">)</span>

<span class="va">ashfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">method_list</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span> <span class="fu">ashr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ashr/man/ash.html">ash</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">betahat</span>, <span class="va">x</span><span class="op">$</span><span class="va">sebetahat</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>
<span class="va">api0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ashfit</span>, FUN <span class="op">=</span> <span class="fu">ashr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ashr/man/get_lfdr.html">get_pi0</a></span><span class="op">)</span>
<span class="va">api0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">api0</span>, MOUTHWASH <span class="op">=</span> <span class="va">mout</span><span class="op">$</span><span class="va">pi0</span><span class="op">)</span>
<span class="va">api0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">api0</span>, BACKWASH <span class="op">=</span> <span class="va">bout</span><span class="op">$</span><span class="va">pi0</span><span class="op">)</span></code></pre></div>
<p>In these data, at least, MOUTHWASH, BACKWASH, and SVA have by far the most accurate estimates of the proportion of genes that are null (<span class="math inline">\(\pi_0\)</span>), which, recall, is 0.9.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">api0</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, col.names <span class="op">=</span> <span class="st">"Estimate of Pi0"</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Estimate of Pi0</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">RUV2</td>
<td align="right">0.9383984</td>
</tr>
<tr class="even">
<td align="left">RUV3</td>
<td align="right">0.9351334</td>
</tr>
<tr class="odd">
<td align="left">RUVb</td>
<td align="right">0.9159205</td>
</tr>
<tr class="even">
<td align="left">SVA</td>
<td align="right">0.9072782</td>
</tr>
<tr class="odd">
<td align="left">BACKWASH</td>
<td align="right">0.8968592</td>
</tr>
<tr class="even">
<td align="left">MOUTHWASH</td>
<td align="right">0.8944090</td>
</tr>
<tr class="odd">
<td align="left">RUV4v</td>
<td align="right">0.7292482</td>
</tr>
<tr class="even">
<td align="left">CATErr</td>
<td align="right">0.7162260</td>
</tr>
<tr class="odd">
<td align="left">RUV4c</td>
<td align="right">0.6990102</td>
</tr>
<tr class="even">
<td align="left">RUV4r</td>
<td align="right">0.3922522</td>
</tr>
</tbody>
</table>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-gerard2020empirical" class="csl-entry">
Gerard, David, and Matthew Stephens. 2020. <span>“<span class="nocase">Empirical <span>B</span>ayes shrinkage and false discovery rate estimation, allowing for unwanted variation</span>.”</span> <em>Biostatistics</em> 21 (1): 15–32. <a href="https://doi.org/10.1093/biostatistics/kxy029">https://doi.org/10.1093/biostatistics/kxy029</a>.
</div>
<div id="ref-gerard2021unifying" class="csl-entry">
———. 2021. <span>“Unifying and Generalizing Methods for Removing Unwanted Variation Based on Negative Controls.”</span> <em>Statistica Sinica</em> 31 (3): 1–22. <a href="https://doi.org/10.5705/ss.202018.0345">https://doi.org/10.5705/ss.202018.0345</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by David Gerard, Peter Carbonetto.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
